(this["webpackJsonpmafmax.rollingretention.app"]=this["webpackJsonpmafmax.rollingretention.app"]||[]).push([[0],{19:function(e,t,n){e.exports=n(31)},31:function(e,t,n){"use strict";n.r(t);n(20);var a=n(0),i=n.n(a),r=n(15),o=n.n(r),l=n(18),s=n(7),c=n.n(s),u=n(10),h=n(1),d=n(2),v=n(5),f=n(4),g=n(3),m=(n(9),function(e){Object(f.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(h.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement("button",{className:"add-button",onClick:this.props.onClick},i.a.createElement("div",{className:"plus"},i.a.createElement("div",{className:"line-horizontal"}),i.a.createElement("div",{className:"line-vertical"})),i.a.createElement("div",{className:"button-text"},this.props.text))}}]),n}(a.Component));m.displayName=m.name;var p=function(e){Object(f.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(h.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement("button",{id:this.props.id,className:"add-button",onClick:this.props.onClick},i.a.createElement("div",{className:"button-text"},this.props.text))}}]),n}(a.Component);p.displayName=p.name;var y=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"parseDateFromLocalDateString",value:function(e){var t=e.split("."),n=(new Date).getTimezoneOffset();return new Date(t[2],t[1]-1,t[0],0,-n)}},{key:"getOneDayMilliseconds",value:function(){return 864e5}},{key:"check",value:function(e){var t=e.split("."),n=new Date,a=n.getTimezoneOffset(),i=new Date(t[2],t[1]-1,t[0],0,-a);return!(i.getTime()>n.getTime())&&(i.getDate()==t[0]&&(i.getMonth()==t[1]-1&&i.getFullYear()==t[2]))}},{key:"localDateStringToIso",value:function(e){var t=e.split("."),n=(new Date).getTimezoneOffset();return new Date(t[2],t[1]-1,t[0],0,-n).toISOString()}},{key:"isoToLocalDateString",value:function(e){return new Date(e).toLocaleDateString()}}]),e}(),D=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"checkFields",value:function(e){for(var t=0;t<e.length;t++)if(0==e[t].valid)return!1;return!0}},{key:"changeValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.getElementById(e);n.value=t}},{key:"removeElementById",value:function(e){document.getElementById(e).remove()}},{key:"getValueById",value:function(e){return document.getElementById(e).value}}]),e}(),b=[],x=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"checkData",value:function(t){if(!D.checkFields(b))return alert("One of the fields (red color) is incorrectly filled."),!1;if(!e.checkDistinctIds(t))return!1;for(var n=0;n<t.length;n++){D.getValueById("userID"+n);var a=D.getValueById("regDate"+n),i=D.getValueById("lastDate"+n);if(!y.check(a))return alert("Incorrect registration date in row "+(n+1)),!1;if(!y.check(i))return alert("Incorrect last activity date in row "+(n+1)),!1;if(e.getLifeTime(t[n])<0)return void alert("Incorrect dates. [ id: "+t[n].id+" registration: "+t[n].registrationDate+" last activity: "+t[n].lastActivityDate+" ]")}return!0}},{key:"getLifeTime",value:function(e){var t=y.parseDateFromLocalDateString(e.registrationDate),n=y.parseDateFromLocalDateString(e.lastActivityDate),a=y.getOneDayMilliseconds();return Math.ceil((n.getTime()-t.getTime())/a)}},{key:"buildDataForChart",value:function(t){for(var n=[],a=[],i=999999999,r=-1,o=0;o<t.length;o++){var l=e.getLifeTime(t[o]);i=Math.min(i,l),r=Math.max(r,l),n.push(l)}var s=Math.ceil((r-i)/25);if(i==r)return[{value:i,frequency:t.length}];for(o=i;o<=r;o+=s){var c=1==s?o:"[ "+o+" - "+(o+s-1)+" ]";a.push({value:c,frequency:n.filter((function(e,t,n){return e>=o&&e<=o+s-1})).length})}return a}},{key:"getRegistrationOffset",value:function(e){var t=y.parseDateFromLocalDateString(e.registrationDate),n=new Date,a=y.getOneDayMilliseconds();return Math.ceil((n.getTime()-t.getTime())/a)}},{key:"rollingRetationXDays",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,a=0,i=0,r=0;r<t.length;r++){var o=e.getLifeTime(t[r]);o>=n&&a++;var l=e.getRegistrationOffset(t[r]);l>=n&&i++}return a/i*100}},{key:"checkDistinctIds",value:function(e){for(var t=0;t<e.length;t++){var n=e.findIndex((function(n,a,i){return n.id==e[t].id})).toString();if(t.toString()!=n)return alert("Duplicates finded in raw "+(t+1)),!1}return!0}}]),e}(),k=function(e){Object(f.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(h.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.renderChart()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("canvas",{id:"myCanvas",style:{background:"white"}}),i.a.createElement("legend",{id:"forMyCanvas"}))}},{key:"renderChart",value:function(){var e=document.getElementById("myCanvas");e.width=.95*document.documentElement.clientWidth,e.height=.5*document.documentElement.clientHeight;var t=e.getContext("2d");function n(e,t,n,a,i,r){e.save(),e.strokeStyle=r,e.beginPath(),e.moveTo(t,n),e.lineTo(a,i),e.stroke(),e.restore()}function a(e,t,n,a,i,r){e.save(),e.fillStyle=r,e.fillRect(t,n,a,i),e.restore()}new function(e){this.options=e,this.canvas=e.canvas,this.ctx=this.canvas.getContext("2d"),this.colors=e.colors;var i=this.options.data;this.draw=function(){for(var e=-1,r=0;r<i.length;r++)e=Math.max(e,i[r].frequency);for(var o=this.canvas.height-2*this.options.padding,l=this.canvas.width-2*this.options.padding,s=0;s<=e;){var c=o*(1-s/e)+this.options.padding;n(this.ctx,30,c,this.canvas.width,c,this.options.gridColor),this.ctx.save(),this.ctx.fillStyle=this.options.gridColor,this.ctx.textBaseline="bottom",this.ctx.font="bold 10px Arial",this.ctx.fillText(s,40,c-2),this.ctx.restore(),s+=.05*e,s=Math.ceil(s)}var u=l/i.length;u=Math.min(l/25,u);for(r=0;r<i.length;r++){var h=i[r].frequency,d=Math.round(o*h/e),v=40+this.options.padding+r*u,f=this.colors[r%this.colors.length];a(this.ctx,v,this.canvas.height-d-this.options.padding,u,d,f),this.ctx.save(),this.ctx.textBaseline="bottom",this.ctx.textAlign="center",this.ctx.fillStyle=f,this.ctx.font="bold 14px Arial",this.ctx.fillText(i[r].value,v+u/2,this.canvas.height-this.options.padding/2),i[r].frequency>0&&(this.ctx.fillStyle="#000000",this.ctx.fillText(i[r].frequency,v+u/2,this.canvas.height-this.options.padding-d)),this.ctx.restore()}this.ctx.save(),this.ctx.textBaseline="bottom",this.ctx.textAlign="center",this.ctx.fillStyle="#000000",this.ctx.font="bold 14px Arial",this.ctx.fillText("Life Cycle",l/2,this.canvas.height),this.ctx.restore(),this.ctx.save(),this.ctx.textBaseline="bottom",this.ctx.textAlign="center",this.ctx.fillStyle="#000000",this.ctx.font="bold 14px Arial",t.font="20px/1 sans-serif",t.textAlign="center";for(r=0;r<"Frequency".length;r++)t.fillText("Frequency"[r],10,80+20*(r+1));this.ctx.restore()}}({canvas:e,seriesName:"Life distribution",padding:30,gridColor:"#888888",data:this.props.data,colors:["#a55ca5"]}).draw()}}]),n}(a.Component),E=function(e){Object(f.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).handleChange=a.handleChange.bind(Object(v.a)(a)),a.state={value:a.props.value},b.push({id:a.props.id,valid:!0}),a}return Object(d.a)(n,[{key:"handleChange",value:function(e){var t=!e.target.validity.patternMismatch,n=this.props.id,a=b.findIndex((function(e,t,a){return e.id==n}));b[a].valid=t,this.setState({value:e.target.value})}},{key:"componentWillUnmount",value:function(){var e=this.props.id,t=b.findIndex((function(t,n,a){return t.id==e}));b.splice(t,1)}},{key:"render",value:function(){return i.a.createElement("input",{pattern:this.props.pattern,className:"input-block",type:"text",placeholder:this.props.placeHolder,id:this.props.id,value:this.state.value,onChange:this.handleChange})}}]),n}(a.Component),w=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"renderChart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=x.buildDataForChart(e);return i.a.createElement(k,{key:t+"chart",data:n})}},{key:"renderRolling",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7,a=x.rollingRetationXDays(e,n),r=isNaN(a)?"The number of users who registered later than "+n+" days is zero. Rolling Retention "+n+" day is NaN.":"Rolling Retention "+n+" day is equal "+a.toFixed(2)+" %";return i.a.createElement("div",{key:t+"rolling"},r)}},{key:"renderTable",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return i.a.createElement("table",{className:"table table-striped"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,i.a.createElement("div",{className:"field-header"},"User Id")),i.a.createElement("th",null,i.a.createElement("div",{className:"field-header"},"Date Registration")),i.a.createElement("th",null,i.a.createElement("div",{className:"field-header"},"Date Last Activity")),i.a.createElement("th",null,i.a.createElement("div",{className:"field-header"},"Remove")))),i.a.createElement("tbody",null,e.map((function(e,a){return i.a.createElement("tr",{key:n+a,id:"user"+a},i.a.createElement("td",null,i.a.createElement(E,{placeHolder:"number",pattern:"[0-9]{1,9}",value:e.id,id:"userID"+a})),i.a.createElement("td",null,i.a.createElement(E,{placeHolder:"dd.mm.yyyy",pattern:"[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{4}",value:e.registrationDate,id:"regDate"+a})),i.a.createElement("td",null,i.a.createElement(E,{placeHolder:"dd.mm.yyyy",pattern:"[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{4}",value:e.lastActivityDate,id:"lastDate"+a})),i.a.createElement("td",null,i.a.createElement(p,{text:"Remove",id:"remove"+a,onClick:t})))}))))}}]),e}(),O=function(e){Object(f.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).state={userRetentionDtos:[],counter:0,loading:!0,countOfErrorFields:0,uniqueKey:0,showCharts:!1},a.onAdd=a.onAdd.bind(Object(v.a)(a)),a.onSave=a.onSave.bind(Object(v.a)(a)),a.onCalculate=a.onCalculate.bind(Object(v.a)(a)),a.onRemove=a.onRemove.bind(Object(v.a)(a)),a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.getUsers()}},{key:"updateUniqueKey",value:function(){this.setState({uniqueKey:(new Date).getTime()})}},{key:"updateUsersData",value:function(){for(var e=this.state.userRetentionDtos,t=[],n=0;n<e.length;n++){var a=D.getValueById("userID"+n),i=D.getValueById("regDate"+n),r=D.getValueById("lastDate"+n);"vals"!=="vals"+a+i+r&&(t.push({id:a,registrationDate:i,lastActivityDate:r}))}return t}},{key:"onSave",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,a,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],n=this.updateUsersData(),x.checkData(n)){e.next=4;break}return e.abrupt("return");case 4:for(a=0;a<n.length;a++)t.push({id:n[a].id,registrationDate:y.localDateStringToIso(n[a].registrationDate),lastActivityDate:y.localDateStringToIso(n[a].lastActivityDate)});i=JSON.stringify(t),this.setState({userRetentionDtos:n}),fetch("/retention/add",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:i}),alert("Data saved");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onCalculate",value:function(){var e=this.updateUsersData();this.updateUniqueKey(),0!=e.length?x.checkData(e)&&this.setState({userRetentionDtos:e,showCharts:!0}):alert("No data for calculating")}},{key:"removeEmptyFields",value:function(){var e=this.updateUsersData();this.updateUniqueKey(),this.setState({userRetentionDtos:e,showCharts:!1})}},{key:"onRemove",value:function(e){var t=e.currentTarget.id.replace("remove","");D.changeValue("userID"+t),D.changeValue("regDate"+t),D.changeValue("lastDate"+t),this.removeEmptyFields()}},{key:"onAdd",value:function(){this.removeEmptyFields();for(var e=this.state.userRetentionDtos,t=(new Date).toLocaleDateString(),n=1;e.filter((function(e,t,a){return e.id==n})).length>0;)n++;e.unshift({id:n,registrationDate:t,lastActivityDate:t}),this.setState((function(t){return{counter:t.counter+1,userRetentionDtos:e,showCharts:!1}}))}},{key:"render",value:function(){var e=this.state.showCharts?w.renderRolling(this.state.userRetentionDtos,this.state.uniqueKey):i.a.createElement("p",null,i.a.createElement("em",null,"Press calculate button to show Rolling Retention info:)")),t=this.state.showCharts?w.renderChart(this.state.userRetentionDtos,this.state.uniqueKey):i.a.createElement("p",null,i.a.createElement("em",null,"Press calculate button to show Life Cycle distribution :)")),n=this.state.loading?i.a.createElement("p",null,i.a.createElement("em",null,"Loading...")):w.renderTable(this.state.userRetentionDtos,this.onRemove,this.state.uniqueKey);return i.a.createElement("div",null,t,e,i.a.createElement("div",null,i.a.createElement(m,{text:"Add one more",onClick:this.onAdd}),i.a.createElement(p,{text:"Save",onClick:this.onSave}),i.a.createElement(p,{text:"Calculate",onClick:this.onCalculate})),n)}},{key:"getUsers",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t,n,a,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("retention");case 2:return t=e.sent,e.next=5,t.json();case 5:for(n=e.sent,a=[],i=0;i<n.length;i++)a.push({id:n[i].id,registrationDate:y.isoToLocalDateString(n[i].registrationDate),lastActivityDate:y.isoToLocalDateString(n[i].lastActivityDate)});this.setState({userRetentionDtos:a,loading:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a.Component);O.displayName=O.name;var C=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function j(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var S=document.getElementsByTagName("base")[0].getAttribute("href"),R=document.getElementById("root");document.title="Rolling Retention",o.a.render(i.a.createElement(l.a,{basename:S},i.a.createElement(O,null)),R),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");C?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):j(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):j(e)}))}}()},9:function(e,t,n){}},[[19,1,2]]]);
//# sourceMappingURL=main.8af9a12e.chunk.js.map